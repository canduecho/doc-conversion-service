文档转换服务 - 系统架构图
==========================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                             客户端层                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   Web 浏览器 │  │   curl 命令  │  │   Postman   │  │   其他客户端  │      │
│  │   (Swagger) │  │   (CLI)     │  │   (测试)    │  │   (移动/桌面) │      │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ HTTP 请求
┌─────────────────────────────────────────────────────────────────────────────┐
│                            FastAPI 应用服务器                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   CORS 中间件 │  │   路由分发   │  │   错误处理   │  │   静态文件   │      │
│  │   (跨域)    │  │   (URL 路由) │  │   (统一错误) │  │   (文件服务) │      │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ API 路由
┌─────────────────────────────────────────────────────────────────────────────┐
│                            API 端点层                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ /api/convert │  │/api/batch-convert│  │  /api/formats  │  │/api/status/{id}│      │
│  │   (单文件)   │  │   (批量转换) │  │   (格式查询) │  │   (状态查询) │      │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 业务逻辑
┌─────────────────────────────────────────────────────────────────────────────┐
│                           业务服务层                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    转换服务 (ConversionService)                    │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   文件验证   │  │   格式检查   │  │   转换调度   │  │   结果处理   │  │
│  │  │   (类型/大小)│  │   (支持检查) │  │   (选择转换器)│  │   (返回结果) │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    验证服务 (ValidationService)                    │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   文件类型   │  │   文件大小   │  │   格式支持   │  │   安全检查   │  │
│  │  │   (MIME 类型)│  │   (100MB 限制)│  │   (转换矩阵) │  │   (恶意文件) │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 转换处理
┌─────────────────────────────────────────────────────────────────────────────┐
│                           转换器层                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                LibreOffice 转换器                                 │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   Office 文档 │  │   格式转换   │  │   进程池管理 │  │   异步处理   │  │
│  │  │   (doc/docx) │  │   (xls/xlsx)│  │   (ppt/pptx)│  │   (odt/ods) │  │
│  │  │   (xls/xlsx) │  │   (ppt/pptx)│  │   (odt/ods) │  │   (rtf/html)│  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   PDF 转换器                                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   PDF 解析   │  │   文本提取   │  │   图片提取   │  │   OCR 识别   │  │
│  │  │   (PyMuPDF) │  │   (pdfplumber)│  │   (图片提取) │  │   (Tesseract)│  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   图片转换器                                       │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   格式转换   │  │   尺寸调整   │  │   质量优化   │  │   批量处理   │  │
│  │  │   (PIL)     │  │   (resize)  │  │   (quality) │  │   (batch)   │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 文件操作
┌─────────────────────────────────────────────────────────────────────────────┐
│                           工具层                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    文件工具 (FileUtils)                            │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   文件保存   │  │   文件清理   │  │   路径管理   │  │   大小检查   │  │
│  │  │   (save)    │  │   (cleanup) │  │   (path)    │  │   (size)    │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    配置管理 (Config)                               │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  │   环境变量   │  │   格式配置   │  │   路径配置   │  │   选项配置   │  │
│  │  │   (env)     │  │   (formats) │  │   (paths)   │  │   (options) │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 存储操作
┌─────────────────────────────────────────────────────────────────────────────┐
│                           存储层                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   temp/     │  │  outputs/   │  │   logs/     │  │   cache/     │      │
│  │  临时文件    │  │  输出文件    │  │   日志文件   │  │   缓存文件    │      │
│  │   (上传)    │  │   (转换结果) │  │   (app.log) │  │   (Redis)   │      │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 系统调用
┌─────────────────────────────────────────────────────────────────────────────┐
│                           系统依赖层                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ LibreOffice │  │  Tesseract  │  │   Poppler   │  │   Python    │      │
│  │   (文档处理) │  │   (OCR 识别) │  │  (PDF 工具)  │  │   (运行时)   │      │
│  │   (soffice) │  │   (tesseract)│  │   (pdftoppm)│  │   (3.8+)    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────────────────────────┘

数据流向:
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│  客户端   │───▶│ FastAPI │───▶│ 业务服务 │───▶│ 转换器   │───▶│  存储   │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
     ▲              │              │              │              │
     │              ▼              ▼              ▼              ▼
     └──────────────┴──────────────┴──────────────┴──────────────┘
                       响应数据流

性能特点:
• 异步处理 (asyncio)
• 进程池管理 (ProcessPoolExecutor)
• 并发转换 (多进程)
• 超时控制 (5分钟)
• 资源限制 (100MB文件, 3个并发进程)

支持的转换:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Office 文档 │───▶│     PDF     │◀───│    图片     │
│ (doc/docx)  │    │   (所有格式) │    │ (jpg/png)   │
│ (xls/xlsx)  │    │             │    │ (gif/bmp)   │
│ (ppt/pptx)  │    │             │    │ (tiff/webp) │
└─────────────┘    └─────────────┘    └─────────────┘ 